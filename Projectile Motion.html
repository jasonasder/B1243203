<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <title>Projectile Motion</title>
    <style>
        :root {
            --nav-bg: #2c3e50;
            --theory-bg: rgba(255, 255, 255, 0.98);
            --lab-bg: #2b323a; 
            --accent-green: #51cf66; 
            --accent-blue: #339af0;
            --accent-orange: #ff922b;
            --accent-yellow: #fcc419; 
            --text-main: #343a40;
        }
        
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0;
            font-family: "Segoe UI", "Microsoft JhengHei", sans-serif;
            background: url('img/bb.webp') no-repeat center center fixed;
            background-size: cover;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        nav {
            height: 60px; background: var(--nav-bg);
            display: flex; align-items: center; padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 100;
        }
        nav a { color: #dee2e6; text-decoration: none; margin-right: 25px; font-weight: bold; font-size: 15px; transition: 0.3s; }
        nav a:hover { color: var(--accent-green); }
        nav a.active { color: var(--accent-green); border-bottom: 2px solid var(--accent-green); }

        #main-container {
            flex-grow: 1; display: flex; padding: 15px; gap: 15px;
            height: calc(100vh - 60px);
        }

        #theory-card {
            width: 400px; background: var(--theory-bg);
            border-radius: 12px; padding: 20px; overflow-y: auto;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        #experiment-card {
            flex-grow: 1; background: var(--theory-bg);
            border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; overflow: hidden;
        }

        #exp-header {
            padding: 15px 20px; background: #f1f3f5;
            border-bottom: 1px solid #dee2e6;
            display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
        }
        .modal {
            display: none; position: fixed; z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #fff; margin: 5% auto; padding: 20px;
            border-radius: 12px; width: 80%; max-height: 80vh; overflow-y: auto;
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--accent-green); pb: 10px;
        }
        table {
            width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd; padding: 12px; text-align: center;
        }
        th { background-color: var(--nav-bg); color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .close-btn { font-size: 28px; cursor: pointer; color: #aaa; }
        .close-btn:hover { color: #000; }

        #canvas-container {
            flex-grow: 1; position: relative;
            background: var(--lab-bg); margin: 10px;
            border-radius: 8px; border: 1px solid #454d55; overflow: hidden;
        }

        canvas { width: 100%; height: 100%; display: block; }

        #telemetry {
            position: absolute; top: 15px; right: 15px;
            background: rgba(33, 37, 41, 0.85); color: var(--accent-yellow);
            padding: 10px; border-radius: 6px; font-family: 'Consolas', monospace;
            font-size: 15px; border-left: 4px solid var(--accent-green);
            pointer-events: none;
        }

        h1 { font-size: 40px; color: var(--text-main); margin: 0 0 0 0; border-bottom: 3px solid var(--accent-green); padding-bottom: 5px; }
        h2 { font-size: 20px; color: #1a5276; margin-top: 20px; border-left: 5px solid #1a5276; padding-left: 10px; }
        p { color: #444; line-height: 1.6; font-size: 16px; text-align: justify; }
        .formula-box { background: #f8f9fa; padding: 10px; border-radius: 6px; font-size: 13px; border: 1px solid #e9ecef; margin-top: 5px; }
        
        .control-group { display: flex; flex-direction: column; align-items: flex-start; gap: 2px; }
        .slider-label { font-size: 12px; font-weight: bold; color: #555; }
        input[type="range"] { width: 110px; cursor: pointer; }
        
        button { 
            background: var(--accent-green); color: white; border: none; padding: 10px 22px; 
            border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        button:hover { background: #40c057; }
        .btn-reset { background: #adb5bd; }
        .btn-reset:hover { background: #868e96; }
    </style>
</head>
<body>


<nav>
    <a href="index.html">Home</a>
    <a href="Projectile Motion.html" class="active">Projectile Motion</a>
    <a href="Mechanical Waves.html">Mechanical Waves</a>
    <a href="Rotation of Rigid Bodies.html">Rotation of Rigid Bodies</a>
    <a href="Equilibrium & Elasticity.html" >Equilibrium & Elasticity</a>
    <a href="Sound & Hearing.html">Sound & Hearing</a>
</nav>

<div id="main-container">
    <div id="theory-card">
        <h1>æ‹‹é«”é‹å‹•</h1>
        <h2>å®šå¾‹å…§å®¹</h2>
        <p>æ‹‹é«”é‹å‹•æ˜¯ç‰©é«”ä»¥åˆé€Ÿåº¦ vâ‚€ èˆ‡æ°´å¹³é¢æˆè§’ Î¸ è¢«æ‹‹å‡ºå¾Œï¼Œåªå—é‡åŠ›å½±éŸ¿çš„é‹å‹•ã€‚æ°´å¹³æ–¹å‘å‹»é€Ÿï¼Œå‚ç›´æ–¹å‘å—é‡åŠ›å½±éŸ¿ï¼Œå½¢æˆæ‹‹ç‰©ç·šè»Œè·¡ã€‚</p>

        <h2>å…¬å¼è¡¨ç¤º</h2>
        <div class="formula-box">
            <b>é€Ÿåº¦åˆ†é‡ï¼š</b><br>
            vâ‚“ = vâ‚€ cosÎ¸<br>
            váµ§ = vâ‚€ sinÎ¸ - g t
        </div>
        <div class="formula-box">
            <b>ä½ç§»æ–¹ç¨‹ï¼š</b><br>
            x = vâ‚€ cosÎ¸ Â· t<br>
            y = vâ‚€ sinÎ¸ Â· t - Â½ g tÂ²
        </div>
        <div class="formula-box">
            <b>é—œéµæ•¸æ“šï¼š</b><br>
            æœ€å¤§é«˜åº¦ï¼šhâ‚˜â‚â‚“ = (vâ‚€Â² sinÂ²Î¸)/(2g)<br>
            é£›è¡Œæ™‚é–“ï¼šT = (2vâ‚€ sinÎ¸)/g<br>
            æ°´å¹³å°„ç¨‹ï¼šR = (vâ‚€Â² sin(2Î¸))/g
        </div>

        <h2>åœ–åƒç†è§£</h2>
        <p>è»Œè·¡æ˜¯ä¸€æ¢å°ç¨±çš„æ‹‹ç‰©ç·šã€‚ç‰©é«”å…ˆä¸Šå‡è‡³æœ€é«˜é»ï¼ˆæ­¤æ™‚é€Ÿåº¦çš„å‚ç›´åˆ†é‡ váµ§ ç‚º 0ï¼‰ï¼Œéš¨å¾Œåœ¨é‡åŠ›åŠ é€Ÿåº¦ä½œç”¨ä¸‹ä¸‹é™è‡³åœ°é¢ã€‚åœ¨å¿½ç•¥ç©ºæ°£é˜»åŠ›çš„æƒ…æ³ä¸‹ï¼Œå…¶å½¢ç‹€å®Œå…¨ç”±åˆé€Ÿåº¦å¤§å°èˆ‡æ‹‹å°„è§’åº¦æ±ºå®šã€‚</p>

        <h2>é©ç”¨ç¯„åœ</h2>
        <p>æœ¬å¯¦é©—æ¨¡å‹é©ç”¨æ–¼<b>å¿½ç•¥ç©ºæ°£é˜»åŠ›</b>ä¸”çš„æƒ…æ³ã€‚ä¸¦ä¸é©ç”¨æ–¼è¶…é«˜é€Ÿï¼ˆç©ºæ°£é˜»åŠ›å¤§ï¼‰æˆ–æ¥µé«˜ç©ºï¼ˆé‡åŠ›éš¨é«˜åº¦è®ŠåŒ–ï¼‰çš„æ‹‹å°„å ´æ™¯ã€‚</p>

        <h2>å¸¸è¦‹æ‡‰ç”¨</h2>
        <p>æ­¤ç‰©ç†æ¨¡å‹å»£æ³›æ‡‰ç”¨æ–¼ï¼š<br>
            1. é‹å‹•ç§‘å­¸ï¼ˆå¦‚ç±ƒçƒæŠ•ç±ƒã€è¶³çƒé–‹çƒï¼‰ã€‚<br>
            3. å½ˆé“å­¸ç ”ç©¶èˆ‡å·¥ç¨‹æ‹‹å°„è¨­è¨ˆã€‚
        </p>

        <h2>å¯¦é©—æ¢ç©¶ä»»å‹™</h2>
        <div class="formula-box" style="border-left: 4px solid var(--accent-blue);">
            1. <b>å°‹æ‰¾æœ€ä½³è§’åº¦ï¼š</b>åˆé€Ÿå›ºå®š 60 m/sï¼Œå“ªå€‹è§’åº¦å°„ç¨‹æœ€é ï¼Ÿ<br>
            2. <b>é‡åŠ›å½±éŸ¿ï¼š</b>åœ¨æœ¨æ˜Ÿç™¼å°„èˆ‡æœˆçƒç™¼å°„ï¼Œé£›è¡Œæ™‚é–“ç›¸å·®å¹¾å€ï¼Ÿ<br>
            3. <b>åˆé€Ÿå€å¢ï¼š</b>åˆé€Ÿå¢åŠ ä¸€å€ï¼Œæœ€å¤§é«˜åº¦æœƒå¢åŠ å¹¾å€ï¼Ÿ
        </div>

        <h2>éš¨å ‚æ¸¬é©—</h2>
        <div id="quiz-area" style="font-size: 14px; background: #fff; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
            <p><b>Q1: åœ¨æœ€é«˜é»æ™‚ï¼Œçƒçš„å‚ç›´é€Ÿåº¦ (Vy) æ˜¯å¤šå°‘ï¼Ÿ</b></p>
            <button onclick="checkQuiz(this, false)" style="padding:5px; font-size:12px; background:#666;">ç­‰æ–¼åˆé€Ÿ</button>
            <button onclick="checkQuiz(this, true)" style="padding:5px; font-size:12px; background:#666;">0 m/s</button>
            <button onclick="checkQuiz(this, false)" style="padding:5px; font-size:12px; background:#666;">æœ€å¤§å€¼</button>
            <p id="quiz-feedback" style="margin-top:10px; color: var(--accent-orange); font-weight:bold;"></p>
        </div>
    </div>

    <div id="experiment-card">
      <div id="exp-header">
          <div class="control-group">
              <span class="slider-label">åˆé€Ÿ vâ‚€: <span id="v0Disp">80</span> m/s</span>
              <input type="range" id="v0" min="10" max="150" value="80" oninput="v0Disp.innerText=this.value; if(!running) resetDraw();">
          </div>
          <div class="control-group">
              <span class="slider-label">è§’åº¦ Î¸: <span id="thetaDisp">45</span>Â°</span>
              <input type="range" id="theta" min="0" max="90" value="45" oninput="thetaDisp.innerText=this.value; if(!running) resetDraw();">
          </div>
          <div class="control-group">
              <span class="slider-label">ç™¼å°„é«˜åº¦ h: <span id="hDisp">0</span> m</span>
              <input type="range" id="y0" min="0" max="1000" value="0" oninput="hDisp.innerText=this.value; if(!running) resetDraw();">
          </div>
          <div class="control-group">
              <span class="slider-label">ç’°å¢ƒ (g)</span>
              <select id="gravity" onchange="clearAll()">
                  <option value="9.8">åœ°çƒ(9.8)</option>
                  <option value="1.62">æœˆçƒ(1.62)</option>
                  <option value="24.8">æœ¨æ˜Ÿ(24.8)</option>
              </select>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; color: #555; border-left: 1px solid #ddd; padding-left: 10px;">
            <label><input type="checkbox" id="showV" checked onchange="syncUI();"> ç¸½é€Ÿåº¦å‘é‡</label>
            <label><input type="checkbox" id="showVectorVal" checked onchange="syncUI();"> å‘é‡æ•¸å€¼</label>
            <label><input type="checkbox" id="showAdvanced" onchange="toggleAdvanced();"> é€²éšæ•¸æ“š</label>
            <label><input type="checkbox" id="showPeakMark" checked onchange="resetDraw();"> æœ€é«˜é»æ¨™è¨˜</label> 
          </div>
          <div id="recordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 style="margin:0;">ğŸ“” å¯¦é©—ç´€éŒ„ç°¿ (è·¨å ´æ™¯æ•¸æ“š)</h2>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <button onclick="clearRecordsOnly()" style="background: #fa5252; padding: 5px 15px; font-size: 13px;">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
                        <span class="close-btn" onclick="closeModal()">&times;</span>
                    </div>
                </div>
                <table id="recordTable">
                    <thead>
                        <tr>
                            <th>å ´æ™¯</th>
                            <th>åˆé€Ÿ (m/s)</th>
                            <th>è§’åº¦ (Â°)</th>
                            <th>é«˜åº¦ (m)</th>
                            <th>é£›è¡Œæ™‚é–“ (s)</th>
                            <th>æ°´å¹³è·é›¢ (m)</th>
                        </tr>
                    </thead>
                    <tbody id="recordBody"></tbody>
                </table>
            </div>
          </div>
            <button onclick="launch()">å•Ÿå‹•æ‹‹å°„</button>
            <button class="btn-reset" onclick="clearAll()" style="background:#fa5252;">æ¸…é™¤</button>
            <button onclick="openModal()" style="background: var(--accent-blue);">ç´€éŒ„ç°¿</button>
      </div>

      <div id="canvas-container" style="position:relative; cursor: grab;">
          <div id="telemetry">
              <span style="color:#adb5bd; font-size:11px;">å¯¦æ™‚æ•¸æ“šçœ‹æ¿</span><br>
              é£›è¡Œæ™‚é–“: <span id="tDisp">0.00</span> s<br>
              æ°´å¹³è·é›¢: <span id="xDisp">0.00</span> m<br>
              ç›®å‰é«˜åº¦: <span id="yDisp">0.00</span> m
              
              <div id="v-data" style="border-top: 1px solid #444; margin-top:5px; padding-top:5px;">
                  <div id="row-total-v" style="display:block;">ç¸½é€Ÿåº¦: <span id="vTotalDisp">0.00</span> m/s</div>
                  <div id="row-comp-v" style="display:block;">
                      <span style="color:#339af0">vx</span>: <span id="vxDisp">0.00</span> | <span style="color:#ff922b">vy</span>: <span id="vyDisp">0.00</span>
                  </div>
              </div>

              <div id="advanced-stats" style="display: none;">
                  <hr style="border:0; border-top:1px solid #444; margin:5px 0;">
                  æœ€é«˜é«˜åº¦: <span id="hMaxDisp">0.00</span> m<br>
                  æœ€é«˜é€Ÿåº¦: <span id="vMaxDisp">0.00</span> m/s
              </div>
          </div>
          
          <div id="log-panel" style="display:none; position:absolute; bottom:20px; left:20px; background:rgba(0,0,0,0.85); color:white; padding:10px; border-radius:5px; font-size:11px; max-height:120px; overflow-y:auto; width:220px; border:1px solid #555; z-index:100;">
              <b>ğŸ“‹ å¯¦é©—ç´€éŒ„è¡¨</b>
              <div id="log-content"></div>
          </div>
          <canvas id="simCanvas"></canvas>
      </div>
  </div>
</div>
<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    
    let running = false, t = 0;
    let currentPath = []; 
    let allPaths = [];    
    let landingDots = []; 
    let experimentRecords = []; 
    let peakMarker = null;      
    let hMax = 0, vMax = 0;

    let scale = 2.0;
    let offsetX = 50, offsetY = 0;  
    let isDragging = false, lastMouseX, lastMouseY;

    function resize() {
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;
        offsetY = canvas.height - 50;
        resetDraw();
    }

    function syncUI() {
        const showV = document.getElementById('showV').checked;
        const showVec = document.getElementById('showVectorVal').checked;
        document.getElementById('row-total-v').style.display = showV ? 'block' : 'none';
        document.getElementById('row-comp-v').style.display = showVec ? 'block' : 'none';
        if (!running) resetDraw();
    }

    function toggleAdvanced() {
        document.getElementById('advanced-stats').style.display = document.getElementById('showAdvanced').checked ? 'block' : 'none';
    }

    function openModal() {
        const tbody = document.getElementById('recordBody');
        if (tbody) {
            tbody.innerHTML = experimentRecords.map(r => `
                <tr>
                    <td>${r.scene}</td>
                    <td>${r.v0}</td>
                    <td>${r.theta}Â°</td>
                    <td>${r.h0}m</td>
                    <td>${r.time}s</td>
                    <td><b style="color:#2b8a3e">${r.range}m</b></td>
                </tr>
            `).join('');
        }
        document.getElementById('recordModal').style.display = "block";
    }

    function closeModal() { document.getElementById('recordModal').style.display = "none"; }

    function checkQuiz(btn, isCorrect) {
        const feedback = document.getElementById('quiz-feedback');
        if(isCorrect) {
            feedback.innerText = "âœ… æ­£ç¢ºï¼æœ€é«˜é»å‚ç›´é€Ÿåº¦æ¶ˆå¤±ï¼Œåƒ…å‰©æ°´å¹³é€Ÿåº¦ã€‚";
            btn.style.background = "var(--accent-green)";
        } else {
            feedback.innerText = "âŒ å†æƒ³æƒ³ï¼æç¤ºï¼šçƒåœ¨æœ€é«˜é»æ™‚æœƒã€Œç¬é–“åœæ­¢ä¸Šå‡ã€ã€‚";
            btn.style.background = "#fa5252";
        }
    }

    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mX = e.clientX - rect.left;
        const mY = e.clientY - rect.top;

        const s = scale;
        const ballX = offsetX;
        const ballY = offsetY - parseFloat(document.getElementById('y0').value) * s;
        const dist = Math.sqrt((mX - ballX)**2 + (mY - ballY)**2);

        if (dist < 20 && !running) {
            isDraggingBall = true; 
            canvas.style.cursor = 'ns-resize';
        } else {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            canvas.style.cursor = 'grabbing';
        }
    });

    let isDraggingBall = false; 
    window.addEventListener('mousemove', (e) => {
        if (isDraggingBall) {
            const rect = canvas.getBoundingClientRect();
            const mY = e.clientY - rect.top;
            let newH = (offsetY - mY) / scale;
            newH = Math.max(0, Math.min(150, newH));
            document.getElementById('y0').value = newH;
            document.getElementById('hDisp').innerText = Math.round(newH);
            resetDraw();
            return;
        }
        
        if (!isDragging) return;
        offsetX += e.clientX - lastMouseX;
        offsetY += e.clientY - lastMouseY;
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
        if (!running) resetDraw();
    });

    window.addEventListener('mouseup', () => {
        isDragging = false;
        isDraggingBall = false;
        canvas.style.cursor = 'grab';
    });
    canvas.addEventListener('wheel', (e) => {
        e.preventDefault();
        const oldScale = scale;
        const zoomSpeed = 0.15;
        scale = Math.min(Math.max(0.1, scale + (e.deltaY > 0 ? -zoomSpeed : zoomSpeed)), 15);

        const rect = canvas.getBoundingClientRect();
        const mX = e.clientX - rect.left; 
        const mY = e.clientY - rect.top;
        
        offsetX = mX - (mX - offsetX) * (scale / oldScale);
        offsetY = mY - (mY - offsetY) * (scale / oldScale);
        if (!running) resetDraw();
    }, { passive: false });

    function launch() {
        if(running) return;
        if(currentPath.length > 0) {
            allPaths.push({ pts: [...currentPath], color: 'rgba(255, 255, 255, 0.15)', peak: peakMarker ? {...peakMarker} : null });
        }
        currentPath = []; t = 0; peakMarker = null;
        const v0 = parseFloat(document.getElementById('v0').value);
        const theta = parseFloat(document.getElementById('theta').value) * Math.PI / 180;
        const y0 = parseFloat(document.getElementById('y0').value);
        const g = parseFloat(document.getElementById('gravity').value);
        hMax = y0; vMax = v0;
        
        if(allPaths.length === 0) {
            const tFlight = (v0 * Math.sin(theta) + Math.sqrt(Math.pow(v0 * Math.sin(theta), 2) + 2 * g * y0)) / g;
            scale = (canvas.width * 0.45) / Math.max(v0 * Math.cos(theta) * tFlight, 40);
            offsetX = 50; offsetY = canvas.height - 50;
        }
        running = true;
        animate();
    }

    function animate() {
        if(!running) return;
        const v0 = parseFloat(document.getElementById('v0').value);
        const theta = parseFloat(document.getElementById('theta').value) * Math.PI / 180;
        const g = parseFloat(document.getElementById('gravity').value);
        const y0 = parseFloat(document.getElementById('y0').value);

        t += 0.04;
        const vx = v0 * Math.cos(theta);
        const vy = v0 * Math.sin(theta) - g * t;
        const x = vx * t;
        const y = y0 + (v0 * Math.sin(theta) * t - 0.5 * g * t * t);
        const cv = Math.sqrt(vx*vx + vy*vy);
        
        if (vy <= 0 && peakMarker === null) peakMarker = { x, y };
        if (y > hMax) hMax = y;
        if (cv > vMax) vMax = cv;

        if(y < 0) { 
            running = false; 
            landingDots.push({x: x, y: 0});

            const gName = g == 9.8 ? "åœ°çƒ" : (g == 1.62 ? "æœˆçƒ" : "æœ¨æ˜Ÿ");
            experimentRecords.push({ 
                scene: gName, 
                v0, 
                theta: document.getElementById('theta').value, 
                h0: y0, 
                time: t.toFixed(2), 
                range: x.toFixed(2) 
            });
            const entry = document.createElement('div');
            entry.innerHTML = `ğŸš€ Î¸:${document.getElementById('theta').value}Â° | R:<b>${x.toFixed(1)}m</b>`;
            const logContent = document.getElementById('log-content');
            if (logContent) logContent.prepend(entry);
            
            return; 
        }

        currentPath.push({x, y});
        if (x * scale + offsetX > canvas.width * 0.7) offsetX = canvas.width * 0.7 - x * scale;

        updateUI(t, x, y, hMax, vMax, vx, vy, cv);
        draw(x, y, vx, vy, g, cv);
        requestAnimationFrame(animate);
    }

    function clearAll() {
        running = false; 
        t = 0;
        currentPath = []; 
        allPaths = []; 
        landingDots = []; 
        peakMarker = null;
        hMax = 0; 
        vMax = 0;

        offsetX = 50; 
        offsetY = canvas.height - 50; 
        scale = 2.0;

        updateUI(0, 0, 0, 0, 0, 0, 0, 0);
        resetDraw();
    }
    function clearRecordsOnly() {
        if (confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰å¯¦é©—ç´€éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚")) {
            experimentRecords = [];
            const tbody = document.getElementById('recordBody');
            if (tbody) tbody.innerHTML = "";
            const logContent = document.getElementById('log-content');
            if (logContent) logContent.innerHTML = "";
        }
    }

    function resetDraw() {
        const y0 = parseFloat(document.getElementById('y0').value);
        const v0 = parseFloat(document.getElementById('v0').value);
        const theta = parseFloat(document.getElementById('theta').value) * Math.PI / 180;
        const g = parseFloat(document.getElementById('gravity').value);
        draw(0, y0, v0 * Math.cos(theta), v0 * Math.sin(theta), g, v0);
    }

    function updateUI(currT, x, y, hM, vM, vx, vy, vt) {
        document.getElementById('tDisp').innerText = currT.toFixed(2);
        document.getElementById('xDisp').innerText = x.toFixed(2);
        document.getElementById('yDisp').innerText = Math.max(0, y).toFixed(2);
        document.getElementById('hMaxDisp').innerText = hM.toFixed(2);
        document.getElementById('vMaxDisp').innerText = vM.toFixed(2);
        document.getElementById('vTotalDisp').innerText = vt.toFixed(2);
        document.getElementById('vxDisp').innerText = vx.toFixed(2);
        document.getElementById('vyDisp').innerText = vy.toFixed(2);
    }

    function draw(curX, curY, vx, vy, g, cv) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const s = scale;
        const showPeak = document.getElementById('showPeakMark').checked;

        drawGridAndAxes();

        allPaths.forEach(p => { 
            ctx.strokeStyle = p.color; ctx.lineWidth = 1; ctx.beginPath();
            p.pts.forEach((pt, i) => { if(i===0) ctx.moveTo(offsetX + pt.x*s, offsetY - pt.y*s); else ctx.lineTo(offsetX + pt.x*s, offsetY - pt.y*s); });
            ctx.stroke();
            if (showPeak && p.peak) drawPeak(p.peak.x, p.peak.y, 'rgba(252, 196, 25, 0.2)');
        });
        
        landingDots.forEach(dot => {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.beginPath(); ctx.arc(offsetX + dot.x * s, offsetY - dot.y * s, 6, 0, Math.PI*2); ctx.fill();
        });

        if (showPeak && peakMarker) drawPeak(peakMarker.x, peakMarker.y, '#fcc419');

        ctx.strokeStyle = '#51cf66'; ctx.lineWidth = 3;
        ctx.beginPath(); currentPath.forEach((pt, i) => { if(i===0) ctx.moveTo(offsetX + pt.x*s, offsetY - pt.y*s); else ctx.lineTo(offsetX + pt.x*s, offsetY - pt.y*s); }); ctx.stroke();

        const sX = offsetX + curX * s; const sY = offsetY - curY * s;
        if(running || curX === 0) {
            ctx.fillStyle = '#fff'; ctx.shadowBlur = 10; ctx.shadowColor = '#51cf66';
            ctx.beginPath(); ctx.arc(sX, sY, 7, 0, Math.PI * 2); ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    function drawPeak(x, y, color) {
        const px = offsetX + x * scale; const py = offsetY - y * scale;
        ctx.strokeStyle = color; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(px-6, py-6); ctx.lineTo(px+6, py+6); ctx.moveTo(px+6, py-6); ctx.lineTo(px-6, py+6); ctx.stroke();
    }

    function drawGridAndAxes() {
        const s = scale;
        ctx.strokeStyle = '#3a3a3a'; ctx.lineWidth = 0.5; ctx.beginPath();
        let gridGap = 50 * s; while (gridGap < 60) gridGap *= 2;
        for(let i = offsetX % gridGap; i < canvas.width; i += gridGap) { ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); }
        for(let j = offsetY % gridGap; j < canvas.height; j += gridGap) { ctx.moveTo(0, j); ctx.lineTo(canvas.width, j); }
        ctx.stroke();
        ctx.strokeStyle = '#999'; ctx.lineWidth = 2.5; ctx.beginPath();
        ctx.moveTo(0, offsetY); ctx.lineTo(canvas.width, offsetY); ctx.moveTo(offsetX, 0); ctx.lineTo(offsetX, canvas.height); ctx.stroke();
        ctx.fillStyle = '#bbb'; ctx.font = "bold 14px Consolas, Arial"; ctx.textAlign = "center";
        let xStep = gridGap / s;
        for (let m = Math.floor(-offsetX/gridGap)*xStep; m < (canvas.width-offsetX)/s + xStep; m += xStep) {
            let px = offsetX + m * s; if(px >= 0 && px <= canvas.width) ctx.fillText(Math.round(m) + "m", px, offsetY + 25);
        }
        ctx.textAlign = "right";
        for (let h = Math.floor((offsetY-canvas.height)/gridGap)*xStep; h < offsetY/s + xStep; h += xStep) {
            let py = offsetY - h * s; if(py >= 0 && py <= canvas.height) ctx.fillText(Math.round(h) + "m", offsetX - 15, py + 5);
        }
    }

    window.addEventListener('resize', resize);
    window.onclick = function(e) { if(e.target == document.getElementById('recordModal')) closeModal(); };
    resize();
</script>
</body>
</html>