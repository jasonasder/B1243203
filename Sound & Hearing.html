<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>聲波與聽覺 (Sound & Hearing)</title>

<style>
  body { 
    font-family:"Microsoft JhengHei",sans-serif; 
    margin:0; padding:0; 
    background: url('img/bb.webp') no-repeat center center fixed; 
    background-size: cover;
    color:#333; 
    line-height:1.8; 
  }
  nav {
    background: rgba(44, 62, 80);
    padding: 15px 20px;
    display: flex;
    justify-content: center;
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  nav .menu a {
    color: #ecf0f1;
    text-decoration: none;
    margin: 0 15px;
    font-size: 16px;
    font-weight: bold;
    transition: 0.3s;
  }
  nav .menu a:hover { color: #f1c40f; }

  header { 
    background: rgba(52, 73, 94, 0.85); 
    color:white; 
    text-align:center; 
    padding:10px 10px; 
  }
  h1 { margin:0; font-size:50px; }

  section { 
    max-width:900px; 
    margin:25px auto; 
    background: rgba(255, 255, 255, 0.92); 
    border-radius:12px; 
    box-shadow:0 8px 32px rgba(0,0,0,0.2); 
    padding:30px 40px; 
  }

  h2 { 
    font-size:35px;
    color:#1a5276; 
    border-left:6px solid #1a5276; 
    padding-left:15px; 
    margin-top:20px; 
    margin-bottom:20px; 
  }

  p { font-size:20px; text-align:justify; }

  .formula-box {
    background: rgba(26, 82, 118, 0.05);
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #1a5276;
    margin: 15px 0;
  }

  .control-panel {
    background: #fdfefe;
    border: 1px solid #d5dbdb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .control { 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    gap: 15px; 
  }

  .control-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    align-items: center;
  }

  label { font-size: 22px; font-weight: bold; }
  input { font-size:18px; padding:6px; width: 100px; border-radius:4px; border:1px solid #ccc; }
  
  button { 
    background:#1a5276; 
    color:white; 
    border:none; 
    cursor:pointer; 
    border-radius:4px; 
    padding: 8px 25px;
    font-size: 18px;
    transition: 0.3s;
  }
  button:hover { background:#2471a3; transform: scale(1.05); }

  #info { 
    display:flex; 
    justify-content:center; 
    gap:25px; 
    margin-top:20px; 
    border-top: 1px solid #eee;
    padding-top: 15px;
    flex-wrap: wrap;
  }
  #info p { font-size: 22px; font-weight: bold; margin: 5px; }
  #info span { color: #d35400; }

  canvas { 
    border:2px solid #333; 
    background:#fff; 
    display:block; 
    margin:20px auto; 
    border-radius: 5px;
  }

  .warning {
    display: inline-block;
    width: 24px;
    height: 24px;
    line-height: 24px;
    margin-right: 8px;
    border-radius: 50%;
    background: #e74c3c;
    color: white;
    font-weight: bold;
    text-align: center;
    cursor: pointer;
    position: relative;
    font-size: 16px;
  }
  .warning::after {
    content: "請避免將振幅調整過大，以免音量過高造成聽覺不適。建議：2 以下";
    position: absolute;
    bottom: 140%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 10;
  }
  .warning:hover::after { opacity: 1; }
</style>
</head>

<body>

<nav>
  <div class="menu">
    <a href="index.html">首頁 (Home)</a>
    <a href="Equilibrium & Elasticity.html">平衡與彈性</a>
    <a href="Mechanical Waves.html">機械波</a>
    <a href="Projectile Motion.html">拋體運動</a>
    <a href="Rotation of Rigid Bodies.html">圓周旋轉</a>
    <a href="Sound & Hearing.html" style="color:#f1c40f">聲音聽覺</a>
  </div>
</nav>

<header>
  <h1>聲波與聽覺（Sound & Hearing）</h1>
</header>

<section>
  <h2>定律內容</h2>
  <p>
    聲音是由物體振動產生的機械波，透過介質（如空氣）以縱波形式傳播。聲波可用正弦函數表示，其振幅與頻率分別影響人耳對聲音大小與音高的感覺。
  </p>
  <h2>公式表示</h2>
  <div class="formula-box">
    聲波位移：y = A sin(2πft)<br>
    A：振幅（影響音量）<br>
    f：頻率（影響音高）
  </div>

  <h2>圖像理解</h2>
  <p>
    波形的上下振動幅度代表振幅大小，單位時間內的振動次數代表頻率高低。振幅越大，聲音越大聲；頻率越高，音高越高。
  </p>

  <h2>適用範圍</h2>
  <p>
    本模型適用於理想聲波與基本聽覺概念說明，未考慮空氣阻力、能量衰減與複合音波。
  </p>

  <h2>常見應用</h2>
  <p>
    音樂音高分析、聲學工程、醫學聽力測試、語音處理與音訊科技等。
  </p>
</section>

<section>
  <h2>實驗模擬：聲波與聽覺</h2>

  <div class="control-panel">
    <div class="control">
      <div class="control-row">
        <label>
          <span class="warning">!</span>振幅 A：
          <input type="number" id="amplitude" value="1" step="0.1" min="0">
        </label>
        <label>
          頻率 f (Hz)：
          <input type="number" id="frequency" value="440" step="10" min="1" max="20000">
        </label>
      </div>
      <div class="control-row">
        <button onclick="startSound()">開始實驗</button>
        <button onclick="stopSound()" style="background:#7f8c8d;">停止</button>
      </div>
    </div>

    <div id="info">
      <p>振幅 A：<span id="ampInfo">1.00</span></p>
      <p>頻率 f：<span id="freqInfo">440</span> Hz</p>
      <p>聽覺狀態：<span id="hearInfo">人耳可聽</span></p>
    </div>
  </div>

  <canvas id="canvas" width="900" height="400"></canvas>
</section>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const yCenter = canvas.height / 2;
const scale = 80;

let A = 1;
let f = 440;
let time = 0;
let playing = false;

const AudioCtx = new (window.AudioContext || window.webkitAudioContext)();
let osc = null;
let gainNode = null;

function startSound(){
  if(playing) stopSound();

  A = parseFloat(document.getElementById("amplitude").value);
  f = parseFloat(document.getElementById("frequency").value);

  time = 0;
  playing = true;

  osc = AudioCtx.createOscillator();
  gainNode = AudioCtx.createGain();

  osc.type = "sine";
  osc.frequency.value = f;
  gainNode.gain.value = A * 0.1;

  osc.connect(gainNode).connect(AudioCtx.destination);
  osc.start();

  requestAnimationFrame(animate);
}

function stopSound(){
  playing = false;
  if(osc){
    osc.stop();
    osc = null;
  }
  drawWave();
}

function animate(){
  if(!playing) return;
  time += 0.005;
  drawWave();
  updateInfo();
  requestAnimationFrame(animate);
}

function drawWave(){
  ctx.clearRect(0,0,canvas.width,canvas.height);


  ctx.beginPath();
  ctx.moveTo(0, yCenter);
  ctx.lineTo(canvas.width, yCenter);
  ctx.strokeStyle = "#ccc";
  ctx.setLineDash([5, 5]);
  ctx.stroke();
  ctx.setLineDash([]);

  ctx.beginPath();
  ctx.strokeStyle = "#1a5276";
  ctx.lineWidth = 2;
  
  let drawFrequency = Math.min(f, 2000) / 500; 

  for(let x=0; x<canvas.width; x++){
    let xTime = time + x / 200;
    let y = yCenter - A * scale * Math.sin(2 * Math.PI * drawFrequency * xTime);
    if(x === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.stroke();
}

function updateInfo(){
  document.getElementById("ampInfo").innerText = A.toFixed(2);
  document.getElementById("freqInfo").innerText = f.toFixed(0);

  let hearText = "";
  if(f < 20){
    hearText = "低於可聽範圍 (次聲波)";
  } else if(f > 20000){
    hearText = "高於可聽範圍 (超音波)";
  } else {
    hearText = "人耳可聽";
  }
  document.getElementById("hearInfo").innerText = hearText;
}

drawWave();
</script>

</body>
</html>